<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Harta Interactivă iData</title>
  
  <!-- Includerea Fonturilor de la Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  
  <!-- Legătura către fișierul CSS -->
  <link rel="stylesheet" href="style.css" />
  
  <!-- Incluzând D3.js pentru manipularea hărților -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  
  <!-- Incluzând html2canvas pentru exportarea hărții -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>

  <!-- Include Turf.js for point on surface calculation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js"></script>

  <style>
    .value-label {
      /* Add any necessary positioning and styling */
      position: absolute;
      pointer-events: none;
      /* Ensure fonts are rendered correctly */
      font-family: 'Roboto', sans-serif;
    }
    /* Style for gradient preview inside the select */
    .gradient-option {
      background: linear-gradient(to right, #2A73FF, #00FF7F);
      display: inline-block;
      width: 100px;
      height: 10px;
      vertical-align: middle;
      margin-left: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="map-column">
      <svg id="mapSVG">
        <g class="map-group"></g>
        <!-- Keep shapes independent from map zoom: -->
        <g id="shapesGroup"></g>
      </svg>
      
      <!-- Footer în dreapta jos -->
      <div class="footer">
        <span>Creat cu iDataMaps.app Versiune Beta</span>
      </div>
    </div>
    <div class="right-panel">
      <div class="control-panel">

        <section class="control-group">
          <h3 data-key="controlPanelTitle">Setările hărții</h3>
          <!-- Secțiunea de Selectare a Hărții -->
          <div class="option-section">
            <h4 data-key="selectMap">Selectează Harta</h4>
            <select id="mapSelector" class="custom-select">
              <option value="md.geojson">Moldova</option>
              <option value="regiuni.geojson">Moldova Regiuni</option>
              <!-- <option value="chisinau.geojson">Chișinău</option> -->
              <option value="romania_new.geojson">România</option>
              <option value="europe.geojson">Europa</option>
              <!-- <option value="combined.geojson">Regiuni statistice iData</option> -->
            </select>
          </div>

          <!-- Secțiunea de Setări Canvas -->
          <div class="option-section">
            <h4 data-key="backgroundSettings">Setările fundalului</h4>
            <label for="canvasColor" data-key="color">Culoare:</label>
            <input type="color" id="canvasColor" value="#ffffff" />

            <label for="canvasTransparency" data-key="transparency">Transparență:</label>
            <input type="range" id="canvasTransparency" min="0" max="1" step="0.1" value="1" />

            <!-- Removed canvasWidth label and input -->

            <label for="canvasHeight" data-key="canvasHeight">Canvas Height (px):</label>
            <input type="number" id="canvasHeight" value="600" />
          </div>

          <!-- Secțiunea de Resetare și Export -->
          <div class="option-section">
            <div class="button-group">
              <button id="exportMap" class="btn btn-export" data-key="exportAsPNG">Exportă ca PNG</button>
            </div>
          </div>
        </section>

        <section class="control-group">
          <h3 data-key="gradient">Gradient</h3>
          <div class="option-section">
            <h4 data-key="selectGradient">Selectează Gradient</h4>
            <div class="gradient-options">
              <div class="custom-gradient">
                <div class="color-picker">
                  <label for="gradientStart" data-key="minValueColor">Culoare valori minime:</label>
                  <input type="color" id="gradientStart" value="#2A73FF" />
                </div>
                
                <div class="color-picker">
                  <label for="gradientEnd" data-key="maxValueColor">Culoare valori maxime:</label>
                  <input type="color" id="gradientEnd" value="#00FF7F" />
                </div>
                
                <button id="applyGradient" class="btn btn-primary" data-key="applyCustomGradient">Aplică Gradient</button>
              </div>
            </div>
          </div>
        </section>

        <section class="control-group">
          <h3 data-key="categoricalData">Date categorice</h3>
          <!-- Secțiunea de Gestionare Categorii -->
          <div class="option-section">
            <h4 data-key="chooseCategories">Alege una sau mai multe categorii</h4>
            <div class="category-manager">
              <div class="add-category">
                <input type="text" id="newCategoryName" class="input-text" data-placeholder="categoryNamePlaceholder" placeholder="Nume Categorie" />
                <input type="color" id="newCategoryColor" value="#FF5733" />
                <button id="addCategory" class="btn btn-primary" data-key="addCategory">Adaugă Categorie</button>
              </div>
              <div class="category-list">
                <ul id="categoryList">
                  <!-- Categorii adăugate din JavaScript -->
                </ul>
              </div>
            </div>
          </div>
        </section>

        <section class="control-group">
          <h3 data-key="text">Text</h3>
          <!-- Secțiunea de Adăugare Text Liber -->
          <div class="option-section">
            <h4 data-key="addText">Adaugă Text</h4>
            <textarea id="freeTextInput" class="input-text" data-placeholder="textPlaceholder" placeholder="Introdu Textul" rows="4"></textarea>
            <div class="text-options">
              <label for="freeTextFont" data-key="font">Font:</label>
              <select id="freeTextFont" class="custom-select">
                <option value="'Roboto', sans-serif">Roboto</option>
                <option value="'Montserrat', sans-serif">Montserrat</option>
                <option value="'Open Sans', sans-serif">Open Sans</option>
                <option value="'Lobster', cursive">Lobster</option>
              </select>
              <label for="freeTextSize" data-key="size">Mărime (px):</label>
              <input type="number" id="freeTextSize" class="input-text" value="14" min="10" max="50" />
              <label for="freeTextColor" data-key="color">Culoare:</label>
              <input type="color" id="freeTextColor" value="#333333" />
              <div style="display: flex; align-items: center; gap: 8px;">
                <label for="freeTextBorder" data-key="border">Chenar:</label>
                <input type="checkbox" id="freeTextBorder" />
                
                <label for="freeTextBold" data-key="bold">Bold:</label>
                <input type="checkbox" id="freeTextBold" />
                
                <label for="freeTextItalic" data-key="italic">Italic:</label>
                <input type="checkbox" id="freeTextItalic" />
              </div>
            </div>
            <button id="addFreeText" class="btn btn-primary" data-key="addTextButton">Adaugă Text</button>
            <button id="removeFreeText" class="btn btn-reset" data-key="removeTextButton">Elimină Text</button>
          </div>

          <!-- Secțiunea de Adăugare Titlu -->
          <div class="option-section">
            <h4 data-key="addTitle">Adaugă Titlu</h4>
            <input type="text" id="titleInput" class="input-text" data-placeholder="titlePlaceholder" placeholder="Introdu Titlul" />
            <div class="title-options">
              <label for="titleFont" data-key="font">Font:</label>
              <select id="titleFont" class="custom-select">
                <option value="'Roboto', sans-serif">Roboto</option>
                <option value="'Montserrat', sans-serif">Montserrat</option>
                <option value="'Open Sans', sans-serif">Open Sans</option>
                <option value="'Lobster', cursive">Lobster</option>
              </select>
              
              <label for="titleSize" data-key="size">Mărime (px):</label>
              <input type="number" id="titleSize" class="input-text" value="24" min="10" max="100" />
              
              <label for="titleColor" data-key="color">Culoare:</label>
              <input type="color" id="titleColor" value="#000000" />
              
              <label for="titleBold" data-key="bold">Bold:</label>
              <input type="checkbox" id="titleBold" />
              
              <label for="titleItalic" data-key="italic">Italic:</label>
              <input type="checkbox" id="titleItalic" />
            </div>
            <button id="addTitle" class="btn btn-primary" data-key="addTitleButton">Adaugă Titlu</button>
            <button id="removeTitle" class="btn btn-reset" data-key="removeTitleButton">Elimină Titlu</button>
          </div>
        </section>

        <section class="control-group">
          <h3 data-key="geometricShapes">Forme geometrice</h3>
          <!-- Secțiunea de Forme Geometrice -->
          <div class="option-section">
            <h4 data-key="addGeometricShape">Adaugă o formă geometrică</h4>
            <button id="addRectangle" class="btn btn-primary" data-key="addRectangle">Adaugă Dreptunghi</button>
            <button id="addCircle" class="btn btn-primary" data-key="addCircle">Adaugă Cerc</button>
            
            <!-- Controls for Adjusting Shapes -->
            <div id="shapeControls" style="display: none; margin-top: 20px;">
              <h3 data-key="adjustShape">Ajustează Forma</h3>
              
              <label for="shapeColor" data-key="color">Culoare:</label>
              <input type="color" id="shapeColor" />
            
              <label for="shapeTransparency" data-key="transparency">Transparență:</label>
              <input type="range" id="shapeTransparency" min="0" max="1" step="0.01" />
            
              <label for="shapeWidth" style="display: none;" data-key="width">Lățime:</label>
              <input type="number" id="shapeWidth" min="10" style="display: none;" />
            
              <label for="shapeHeight" style="display: none;" data-key="height">Înălțime:</label>
              <input type="number" id="shapeHeight" min="10" style="display: none;" />
              
              <!-- New Radius Control for Circles -->
              <label for="shapeRadius" style="display: none;" data-key="radius">Rază:</label>
              <input type="number" id="shapeRadius" min="10" style="display: none;" />
            
              <!-- Delete Button -->
              <button id="deleteShape" class="btn btn-delete" data-key="deleteShape">Șterge Forma</button>
            </div>
          </div>
        </section>

        <!-- Secțiunea de Tabel de Date -->
        <div class="option-section">
          <h4 data-key="dataTable">Tabel de Date</h4>
          <!-- Adăugăm secțiunea de import CSV -->
          <div class="csv-import-section">
            <h5 data-key="csvImport">Import din CSV</h5>
            <input type="file" id="csvFileInput" accept=".csv" class="input-text" />
            <button id="importCSV" class="btn btn-primary" data-key="importCSV">Importă CSV</button>
            <div class="csv-template">
              <small data-key="csvTemplate">Format CSV: Region,Value</small>
              <button id="downloadTemplate" class="btn btn-export" data-key="downloadTemplate">Descarcă Template</button>
            </div>
          </div>
          <!-- Adăugăm secțiunea de căutare și sortare -->
          <div class="table-controls">
            <div class="search-container">
              <input type="text" id="searchRegions" class="input-text" data-placeholder="searchRegionsPlaceholder" placeholder="Caută regiuni..." />
            </div>
            <div class="sort-controls">
              <button id="sortByName" class="btn btn-secondary" data-key="sortByName">
                Sortare după nume ↕
              </button>
              <button id="sortByValue" class="btn btn-secondary" data-key="sortByValue">
                Sortare după valoare ↕
              </button>
            </div>
          </div>
          <div class="table-container">
            <table id="regionTable">
              <thead>
                <tr>
                  <th data-key="regionCountry">Regiune/Țară</th>
                  <th data-key="value">Valoare</th>
                  <th data-key="category">Categorie</th>
                </tr>
              </thead>
              <tbody>
                <!-- Populat din JavaScript -->
              </tbody>
            </table>
          </div>
          <button id="resetAll" class="btn btn-reset" data-key="resetData">Resetează datele</button>
        </div>

        <!-- Secțiunea pentru Controlul Valorilor pe Harta -->
        <div class="option-section">
          <h4 data-key="controlValuesOnMap">Control Valori pe Harta</h4>
          <div class="control-values">
            <label for="toggleValues" data-key="toggleValues">Afișează/Ascunde Valorile:</label>
            <input type="checkbox" id="toggleValues" checked />
            
            <label for="valuesFontSize" data-key="fontSize">Mărime Font:</label>
            <input type="number" id="valuesFontSize" class="input-text" value="14" min="10" max="50" />
            
            <label for="valuesColor" data-key="fontColor">Culoare Font:</label>
            <input type="color" id="valuesColor" value="#000000" />

            <label for="valuesFont" data-key="font">Font Valorilor:</label>
            <select id="valuesFont" class="custom-select">
              <option value="'Roboto', sans-serif">Roboto</option>
              <option value="'Montserrat', sans-serif">Montserrat</option>
              <option value="'Open Sans', sans-serif">Open Sans</option>
              <option value="'Lobster', cursive">Lobster</option>
            </select>
          </div>
        </div>

        <div class="option-section">
          <h4 data-key="styleLegends">Stilizează legendele</h4>
          
          <div class="legend-styling">
            <!-- Grup 1: Font -->
            <div class="control-group">
              <label for="legendFont" data-key="font">Font:</label>
              <select id="legendFont" class="custom-select">
                <option value="Roboto, sans-serif">Roboto</option>
                <option value="Montserrat, sans-serif">Montserrat</option>
                <option value="Open Sans, sans-serif">Open Sans</option>
                <option value="Lobster, cursive">Lobster</option>
              </select>
            </div>
        
            <!-- Grup 2: Mărime Font -->
            <div class="control-group">
              <label for="legendFontSize" data-key="fontSize">Mărime Font (px):</label>
              <input
                type="number"
                id="legendFontSize"
                class="input-text"
                value="14"
                min="10"
                max="50"
              />
            </div>
        
            <!-- Grup 3: Stil Font -->
            <div class="control-group">
              <label for="legendFontStyle" data-key="fontStyle">Stil Font:</label>
              <select id="legendFontStyle" class="custom-select">
                <option value="normal">Normal</option>
                <option value="italic">Italic</option>
                <option value="bold">Bold</option>
                <option value="bold italic">Bold Italic</option>
              </select>
            </div>
        
            <!-- Grup 4: Culoare Font -->
            <div class="control-group">
              <label for="legendColor" data-key="fontColor">Culoare Font:</label>
              <input type="color" id="legendColor" value="#000000" />
            </div>
        
            <!-- Grup 5: Transparență Fundal -->
            <div class="control-group">
              <label for="legendBgTransparency" data-key="bgTransparency">Transparență Fundal:</label>
              <input
                type="range"
                id="legendBgTransparency"
                min="0"
                max="1"
                step="0.1"
                value="0.8"
              />
            </div>
        
            <!-- Grup 6: Lățime Legendă -->
            <div class="control-group">
              <label for="legendWidth" data-key="legendWidth">Lățime Legendă (px):</label>
              <input
                type="number"
                id="legendWidth"
                class="input-text"
                value="200"
                min="100"
                max="500"
              />
            </div>
        
            <!-- Grup 7: Înălțime Legendă -->
            <div class="control-group">
              <label for="legendHeight" data-key="legendHeight">Înălțime Legendă (px):</label>
              <input
                type="number"
                id="legendHeight"
                class="input-text"
                value="100"
                min="50"
                max="300"
              />
            </div>
        
            <!-- Grup 8: Chenar -->
            <div class="control-group">
              <label for="legendBorder" data-key="border">Chenar:</label>
              <input type="checkbox" id="legendBorder" checked />
            </div>
        
            <!-- Buton pentru vizibilitatea legendei -->
            <div class="control-group">
              <button
                id="toggleLegend"
                class="btn btn-primary"
                data-key="toggleLegend"
              >
                Ascunde/Adaugă Legenda
              </button>
            </div>
        
            <!-- Buton pentru vizibilitatea legendei numerice -->
            <div class="control-group">
              <button
                id="toggleNumericLegend"
                class="btn btn-primary"
                data-key="toggleNumericLegend"
              >
                Afișează/Ascunde Legenda Numerică
              </button>
            </div>
          </div>
        </div>
        

        <!-- Spațiu pentru viitoare funcționalități  -->
        <div class="option-section future-feature">
          <h4 data-key="futureFeatures">Viitoare Funcționalități</h4>
          <p data-key="futureFeatureDescription">Aici va fi adăugată funcționalitatea viitoare.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Language Selector -->
  <div id="languageSelectorContainer">
    <label for="languageSelector" data-key="language">Language:</label>
    <select id="languageSelector">
        <option value="ro">Română</option>
        <option value="en">English</option>
    </select>
  </div>

  <!-- Tooltip pentru informații suplimentare -->
  <div class="tooltip"></div>
  
  <!-- Legătura către fișierul JavaScript -->
  <script src="script.js"></script>
</body>
</html>
